---
id: "ff01774b-2274-4f54-99b8-7d16c47d8ef6"
title: "Fix frontend-backend deployment with Vercel+Render"
kind: process
created: 2026-01-12
updated: 2026-01-12
review_after: 2026-04-12
status: active
tags: ["cors", "deployment", "frontend", "nestjs", "planning", "proxy", "render", "strategic", "vercel", "vite"]
filenames: ["/home/linuxcore/Proyectos/impostor/backend/package.json", "/home/linuxcore/Proyectos/impostor/backend/src/main.ts", "/home/linuxcore/Proyectos/impostor/frontend/package.json", "/home/linuxcore/Proyectos/impostor/frontend/vite.config.ts", "backend/src/main.ts", "frontend/vite.config"]
links: ["01ca0c2e-3be5-40e8-b960-0bda5ca191fc"]
---

# Solution
Ahora mismo tu “problema de despliegue” viene de que **en local** el frontend usa un **proxy de Vite** hacia una IP privada:

- `frontend/vite.config.ts` proxya `"/api"` a `http://192.168.0.31:3000` (tu red local).
- En internet **esa IP no existe**, así que en producción el frontend no sabrá a dónde llamar a `/api`.

La solución robusta es: **desplegar backend con una URL pública** y hacer que el frontend apunte a esa URL (o que “/api” se rewritée hacia el backend).

Abajo tienes un plan completo (con corner cases) + 2 alternativas por si una opción no te funciona.

---

## Opción A (recomendada): Frontend en Vercel (gratis) + Backend en Render (gratis)

### 0) Sube el repo a GitHub
Asegúrate de que en GitHub esté la estructura:
- `/frontend`
- `/backend`

---

## 1) Desplegar BACKEND (NestJS) en Render (Free)
Render tiene **web services gratis**, pero **se duermen a los 15 min sin tráfico** (el primer request luego tardará). ([render.com](https://render.com/free?utm_source=openai))

**Pasos:**
1. En Render: **New → Web Service**
2. Conecta tu repo de GitHub.
3. Configura:
   - **Root Directory**: `backend`
   - **Build Command**:
     ```bash
     npm ci && npm run build
     ```
   - **Start Command**:
     ```bash
     npm run start:prod
     ```
4. Variables de entorno (muy importante para CORS en tu `backend/src/main.ts`):
   - `FRONTEND_URL` = `https://TU_APP.vercel.app` (la pondrás cuando tengas la URL de Vercel)

**Corner cases backend:**
- **CORS exacto**: `FRONTEND_URL` debe incluir `https://` y NO llevar `/` al final (ej: `https://impostor.vercel.app`).
- **Preview deployments de Vercel**: si usas previews, tendrán otra URL distinta. Si te falla CORS en previews, te digo abajo cómo hacerlo “a prueba de previews”.
- **Logs en disco**: tu backend guarda telemetry en `backend/logs/...`. En hosting gratuito, **ese fichero puede no persistir** tras reinicios/redeploys. Si te importa conservarlo, necesitarías disco persistente o cambiar a logs estándar (console).

Cuando Render termine, tendrás una URL tipo:
`https://tu-backend.onrender.com`

---

## 2) Desplegar FRONTEND (Vite/React) en Vercel (gratis)
Vercel tiene plan Hobby gratis. ([vercel.com](https://vercel.com/docs/plans/hobby?utm_source=openai))

**Pasos:**
1. En Vercel: **New Project → Import Git Repository**
2. Configura:
   - **Root Directory**: `frontend`
   - Detectará Vite automáticamente
   - Build suele ser `npm run build` (Vercel lo pone solo; si no, pon):
     ```bash
     npm ci && npm run build
     ```
   - Output: `dist`

Al terminar tendrás:
`https://TU_APP.vercel.app`

---

# 3) Conectar frontend ↔ backend (dos maneras)

## Manera 1 (la más robusta y “sin CORS”): Rewrites en Vercel para `/api`
Así **no cambias código** si ya llamas a `/api/...`.

En `frontend/` crea un `vercel.json` (ojo: dentro del root directory del proyecto de Vercel, o sea `frontend/` si has puesto Root Directory frontend):

```json
{
  "rewrites": [
    { "source": "/api/(.*)", "destination": "https://TU_BACKEND.onrender.com/api/$1" }
  ]
}
```

Ventajas:
- El navegador llama a `https://TU_APP.vercel.app/api/...` (mismo origen) → **cero problemas de CORS**
- Mantienes el proxy de Vite para local sin tocar nada

Corner cases:
- Si tu backend cambia de URL, hay que actualizar el `vercel.json`.
- Si alguna ruta del backend no empieza por `/api`, ajusta el rewrite.

## Manera 2: Variable `VITE_API_BASE_URL` + cambiar `fetch`
Si prefieres llamadas directas cross-origin al backend:
1. En Vercel → Project Settings → Environment Variables:
   - `VITE_API_BASE_URL = https://TU_BACKEND.onrender.com`

2. En tu frontend, donde tengas `fetch('/api/...')` cámbialo a:
   - `fetch(import.meta.env.VITE_API_BASE_URL + '/api/...')`

Corner cases:
- Aquí **sí necesitas CORS** bien configurado en Nest.
- Si usas `credentials: true` en CORS (ahora lo tienes activado), no puedes usar `origin: '*'`. Si no usas cookies, lo más simple es poner `credentials: false`.

---

## 4) CORS “a prueba de Vercel previews” (si lo necesitas)
Tu backend ahora hace:
```ts
app.enableCors({
  origin: process.env.FRONTEND_URL || 'http://localhost:5173',
  credentials: true,
});
```

Si quieres permitir:
- local (`http://localhost:5173`)
- producción (`https://tuapp.vercel.app`)
- previews (`https://algo-git-....vercel.app`)

Usa un `origin` function y desactiva credentials si no lo necesitas:

```ts
app.enableCors({
  origin: (origin, cb) => {
    const allowed = [
      'http://localhost:5173',
      process.env.FRONTEND_URL,
    ].filter(Boolean) as string[];

    if (!origin) return cb(null, true); // curl/postman

    if (allowed.includes(origin)) return cb(null, true);
    if (origin.endsWith('.vercel.app')) return cb(null, true);

    return cb(new Error('Not allowed by CORS'), false);
  },
  credentials: false,
});
```

---

# Alternativas (por si A no te encaja)

## Alternativa B: Frontend en Netlify (gratis) + Backend en Render/Koyeb
Netlify tiene plan Free (con límites mensuales). ([netlify.com](https://www.netlify.com/pricing/?utm_source=openai))

- Frontend en Netlify (root `frontend`, build `npm run build`, publish `dist`)
- Para evitar CORS igual que en Vercel, Netlify soporta redirects/proxy con `_redirects` o `netlify.toml` (puedes hacer `/api/* -> https://backend/...`).

## Alternativa C (muy limpia): Servir el frontend desde NestJS y desplegar SOLO 1 cosa
Idea: `npm run build` del frontend, copias `frontend/dist` dentro del backend y Nest sirve estáticos. Ventajas:
- 1 sola URL (más simple)
- 0 CORS
- `/api` y frontend en el mismo dominio

Requiere cambios de código (añadir `@nestjs/serve-static`, configurar rutas, y un paso de build que copie `dist/`).

---

## Pregunta para guiarte sin perder tiempo
¿Cuál quieres hacer?

1) **Vercel rewrites + Render** (recomendada, sin tocar fetch/CORS normalmente)  
2) **Env var `VITE_API_BASE_URL` + Render** (tocas frontend y CORS)  
3) **Todo en un solo deploy (Nest sirve el frontend)**

Dime cuál eliges y **te doy los pasos exactos** con los nombres de servicios y los archivos concretos a crear/modificar en tu repo.